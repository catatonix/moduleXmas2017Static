<html><head></head><body><div hidden="" by-polymer-bundler=""><script>class CheeseAnalytics extends HTMLElement{constructor(){super(),this.style.display='none'}connectedCallback(){(function(b,c,d,e,f,g,a){b.GoogleAnalyticsObject=f,b[f]=b[f]||function(){(b[f].q=b[f].q||[]).push(arguments)},b[f].l=1*new Date,g=c.createElement(d),a=c.getElementsByTagName('body')[0],g.async=1,g.src=e,a.parentNode.insertBefore(g,a)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create',this.getAttribute('key'),'auto'),ga('send','pageview')}}customElements.define('cheese-analytics',CheeseAnalytics);</script><dom-module id="cheese-scanner"><template><style>#wrapper{position:relative;width:100%;height:100%;overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:filter;transition:filter 400ms ease-in-out;filter:opacity(0) blur(0px) brightness(1) sepia(0%) grayscale(0%);}#wrapper.show{filter:opacity(1) blur(0px) brightness(1) sepia(0%) grayscale(0%);}#wrapper.scan,
      #wrapper.animate{filter:opacity(1) blur(5px) brightness(1) sepia(0%) grayscale(0%);}#wrapper.animate{animation:cheese-blur 2s ease-in-out infinite;}#wrapper #line{pointer-events:none;display:block;position:absolute;z-index:1;top:0;left:0;width:100%;height:100%;mix-blend-mode:hard-light;visibility:hidden;will-change:transform;color:transparent;transform:translateY(-100%);}#wrapper.animate #line{visibility:visible;background:linear-gradient(to bottom, transparent 47%, rgba(76, 147, 0, 1) 50%, transparent 53%);animation:cheese-scan 2s cubic-bezier(.33, .5, .75, .4) infinite alternate;}@keyframes cheese-scan{0%{transform:translateY(-100%);}100%{transform:translateY(100%);}}@keyframes cheese-blur{0%{filter:opacity(1) blur(5px) brightness(1) sepia(0%) grayscale(0%);}50%{filter:opacity(1) blur(10px) brightness(1.6) sepia(80%) grayscale(80%);}100%{filter:opacity(1) blur(5px) brightness(1) sepia(0%) grayscale(0%);}}</style><div id="wrapper" on-transitionend="_onTransitionend" on-animationiteration="_onAnimationiteration"><slot></slot><div id="line" aria-live="polite">scanning</div></div></template><script>class CheeseScanner extends Polymer.Element{static get is(){return'cheese-scanner'}static get properties(){return{scan:{type:Boolean,observer:'_scanChanged'},show:{type:Boolean,observer:'_showChanged'},scanning:{type:Boolean,readOnly:!0,notify:!0},minimumIterations:{type:Number,value:2},iterationsCount:{type:Number}}}_showChanged(a){this.$.wrapper.classList.toggle('show',a)}_scanChanged(a){this.$.wrapper.classList.toggle('scan',a),a&&(this._setScanning(!0),this.iterationsCount=0)}_onTransitionend(a){console.log('transition done:',a.propertyName),this.$.wrapper.classList.toggle('animate',this.scan),this._setScanning(this.scan)}_onAnimationiteration(a){a.target!==this.$.wrapper||(this.iterationsCount++,console.log('iteration done:',this.iterationsCount),this.$.line.textContent+='',!this.scan&&this.scanning&&this.iterationsCount>=this.minimumIterations&&(this.$.wrapper.style.filter='opacity(1) blur(5px) brightness(1) sepia(0%) grayscale(0%)',this.$.wrapper.classList.toggle('animate',!1),this._setScanning(!1),setTimeout(()=>this.$.wrapper.style.filter='')))}}customElements.define(CheeseScanner.is,CheeseScanner);</script></dom-module><script>class VisionApiImageAnnotations extends Polymer.Element{static get is(){return'vision-api-image-annotations'}static get properties(){return{apiKey:{type:String},loading:{type:Boolean,readOnly:!0,notify:!0},imageDataUrl:{type:String},lastAnnotations:{type:Object,readOnly:!0,notify:!0}}}static get observers(){return['_loadAnnotations(imageDataUrl, apiKey)']}constructor(){super(),this.style.display='none'}reload(){this._loadAnnotations(this.imageDataUrl,this.apiKey)}_loadAnnotations(a,b){if(!a||!b)return this._setLastAnnotations(null),void this._setLoading(!1);const c=new XMLHttpRequest;c.open('POST','https://vision.googleapis.com/v1/images:annotate?key='+b,!0),c.onload=()=>{let a=null;if(304===c.status||0===c.status||200<=c.status&&300>c.status){const b=JSON.parse(c.response||c.responseText);a=b.responses?b.responses[0]:null}this._computeFaces(a),this._setLastAnnotations(a),this._setLoading(!1)},c.onerror=()=>{this._setLastAnnotations(null),this._setLoading(!1)};const d=a.substring(a.indexOf(',')+1);this._setLoading(!0),c.send(JSON.stringify({requests:[{image:{content:d},features:[{type:'FACE_DETECTION',maxResults:'20'},{type:'LABEL_DETECTION'}]}]}))}_computeFaces(a){a&&a.faceAnnotations&&a.faceAnnotations.forEach((a)=>{Object.assign(a,{emotions:this._computeFaceEmotions(a),bounds:this._computeFaceBounds(a)})})}_computeFaceEmotions(a){const b=['VERY_LIKELY','LIKELY','POSSIBLE'],c=[];for(let d=0;d<b.length;++d){const e=b[d];a.joyLikelihood===e&&c.push('joy'),a.surpriseLikelihood===e&&c.push('surprise'),a.sorrowLikelihood===e&&c.push('sorrow'),a.angerLikelihood===e&&c.push('anger')}return c.length||c.push('normal'),c}_computeFaceBounds(a){const b=this._computeBounds(a.boundingPoly.vertices,[0,1,2,3]),c=this._computeBounds(a.fdBoundingPoly.vertices,[0,1,2,3]),d=this._computeLandmarks(a),e={x:a.tiltAngle,y:a.panAngle,z:a.rollAngle},f={};return f.face=Object.assign({},b),f.face.width>=f.face.height?(f.face.top+=f.face.height/2-f.face.width/2,f.face.height=f.face.width):(f.face.left+=f.face.width/2-f.face.height/2,f.face.width=f.face.height),f.face.rotation=e,f.aboveFace=Object.assign({},b),f.aboveFace.top-=f.aboveFace.height,f.aboveFace.anchorPoint={x:0.5,y:1},f.forehead=Object.assign({},c),f.forehead.top-=f.forehead.height,f.forehead.anchorPoint={x:0.5,y:1.5},f.forehead.rotation=e,f.leftEye=this._computeBounds(d,['LEFT_EYE_PUPIL']),f.leftEye.width=f.leftEye.height=0.3*b.width,f.leftEye.left-=f.leftEye.width/2,f.leftEye.top-=f.leftEye.width/2,f.leftEye.rotation=e,f.rightEye=this._computeBounds(d,['RIGHT_EYE_PUPIL']),f.rightEye.width=f.rightEye.height=0.3*b.width,f.rightEye.left-=f.rightEye.width/2,f.rightEye.top-=f.rightEye.height/2,f.rightEye.rotation=e,f.eyes=this._computeBounds(d,['MIDPOINT_BETWEEN_EYES']),f.eyes.width=f.eyes.height=0.7*b.width,f.eyes.left-=f.eyes.width/2,f.eyes.top-=f.eyes.height/2,f.eyes.rotation=e,f.nose=this._computeBounds(d,['MIDPOINT_BETWEEN_EYES','NOSE_TIP','NOSE_BOTTOM_RIGHT','NOSE_BOTTOM_LEFT','NOSE_BOTTOM_CENTER']),f.nose.left+=f.nose.width/2-f.nose.height/2,f.nose.width=f.nose.height,f.nose.rotation=e,f.mouth=this._computeBounds(d,['MOUTH_CENTER']),f.mouth.width=f.mouth.height=0.5*c.width,f.mouth.left-=f.mouth.width/2,f.mouth.top-=f.mouth.height/2,f.mouth.rotation=e,f}_computeLandmarks(a){return a.landmarks.reduce((a,b)=>(a[b.type]=b.position,a),{})}_computeBounds(a,b){const c=this._computeMinMax(a,b),d=c.min.x,e=c.min.y,f=c.max.x-d,g=c.max.y-e;return{top:e,left:d,width:f,height:g}}_computeMinMax(a,b){return b.reduce((b,c)=>{var d=Math.max,e=Math.min;const f=a[c]||{};return b.min.x=e(f.x||0,b.min.x),b.min.y=e(f.y||0,b.min.y),b.min.z=e(f.z||0,b.min.z),b.max.x=d(f.x||0,b.max.x),b.max.y=d(f.y||0,b.max.y),b.max.z=d(f.z||0,b.max.z),b},{min:{x:Infinity,y:Infinity,z:Infinity},max:{x:-Infinity,y:-Infinity,z:-Infinity}})}}customElements.define(VisionApiImageAnnotations.is,VisionApiImageAnnotations);</script><dom-module id="fancy-carousel"><template><style>:host{display:block;position:relative;overflow:hidden;}div > ::slotted(:not([selected])){display:none;}button{position:fixed;top:calc(50% - 20px);padding:0;line-height:40px;border:none;background:none;color:#fff;font-size:40px;font-weight:bold;opacity:0;}button{outline:none;border-radius:50%;filter:drop-shadow(0px 1px 1px rgba(0,0,0,0.8));}button:focus{filter:drop-shadow(0px 1px 1px rgba(0,0,0,0.8)) drop-shadow(0px 0px 5px white);}button:active{filter:drop-shadow(0px 1px 1px rgba(0,0,0,0.8)) drop-shadow(0px 0px 5px white) contrast(300%);}button:hover,
      button:focus{opacity:1;}#prevBtn{left:12px;}#nextBtn{right:12px;}#wrapper{contain:content;height:100%;will-change:filter, transform;filter:opacity(1) blur(0);transition:filter 0.2s ease-out, transform 0.2s ease-out;}button.idle{animation:cheese-blink 6s linear infinite;}@keyframes cheese-blink{70%{opacity:0;}73%{opacity:1;}77%{opacity:1;}80%{opacity:0;}83%{opacity:1;}87%{opacity:1;}90%{opacity:0;}93%{opacity:1;}97%{opacity:1;}100%{opacity:0;}}</style><div id="wrapper"><slot></slot></div><button id="prevBtn" on-click="previous" aria-label="previous effect">❮</button> <button id="nextBtn" on-click="next" aria-label="next effect">❯</button></template><script>let supportsPassive=!1;try{const a=Object.defineProperty({},'passive',{get:()=>supportsPassive=!0});window.addEventListener('test',null,a)}catch(a){}class FancyCarousel extends Polymer.Element{static get is(){return'fancy-carousel'}static get properties(){return{selected:{type:Object,notify:!0,observer:'_selectedChanged'},swipeSpan:{type:Number,value:window.innerWidth/2},maxBlur:{type:Number,value:0}}}connectedCallback(){super.connectedCallback(),this.shadowRoot.addEventListener('slotchange',this._resetSelected.bind(this)),this._resetSelected(),requestAnimationFrame(this._installListeners.bind(this))}previous(){const a=this.selected&&this.selected.previousElementSibling;if(a&&!this._touchDir){const b=this.selected;this._translateX(b,0),this._translateX(a,-this.offsetWidth),this.selected=a,this._translateX(b,this.offsetWidth,!0),this._translateX(a,0,!0)}}next(){const a=this.selected&&this.selected.nextElementSibling;if(a&&!this._touchDir){const b=this.selected;this._translateX(b,0),this._translateX(a,this.offsetWidth),this.selected=a,this._translateX(b,-this.offsetWidth,!0),this._translateX(a,0,!0)}}_resetSelected(){this.selected&&this.selected.parentElement===this||(this.selected=this.firstElementChild,this.$.prevBtn.classList.add('idle'),this.$.nextBtn.classList.add('idle'))}_selectedChanged(a,b){b&&b.removeAttribute('selected'),a&&a.setAttribute('selected',''),this.$.prevBtn.style.display=a&&!!a.previousElementSibling?'':'none',this.$.nextBtn.style.display=a&&!!a.nextElementSibling?'':'none',this.$.prevBtn.classList.remove('idle'),this.$.nextBtn.classList.remove('idle')}_translateX(a,b,c){a.style.display='block',a.style.transition=c?'transform 0.2s':'',a.style.transform='translate3d('+b+'px, 0, 0)'}_blurWrapper(a,b){this.$.wrapper.style.transition=b?'':'none';let c=b||10>a&&-10<a?0:Math.abs(a)/this.swipeSpan;1<c&&(c=Math.max(0,1-(c-1)));const d=this.maxBlur*c*c,e=1-0.2*c,f=1+0.1*c;this.$.wrapper.style.filter=`opacity(${e}) blur(${d}px)`,this.$.wrapper.style.transform=`scale(${f})`}_installListeners(){this.addEventListener('transitionend',this._resetChildrenStyles.bind(this)),this.addEventListener('touchstart',this._touchstart.bind(this),!!supportsPassive&&{passive:!0}),this.addEventListener('touchmove',this._touchmove.bind(this),!!supportsPassive&&{passive:!0}),this.addEventListener('touchend',this._touchend.bind(this))}_resetChildrenStyles(){for(let a=this.firstElementChild;a;)a.style.display='',a.style.transition='',a.style.transform='',a=a.nextElementSibling;this.$.wrapper.style.transition='',this.$.wrapper.style.filter='',this.$.wrapper.style.transform=''}_touchstart(a){2>this.childElementCount||!this._touchDir&&(this._startX=a.changedTouches[0].clientX,this._startY=a.changedTouches[0].clientY)}_touchmove(a){var b=Math.abs;if(!(2>this.childElementCount)){if(!this._touchDir){const c=b(a.changedTouches[0].clientX-this._startX),d=b(a.changedTouches[0].clientY-this._startY);this._touchDir=c>d?'x':'y'}if('x'===this._touchDir){let b=Math.round(a.changedTouches[0].clientX-this._startX);const c=this.selected.previousElementSibling,d=this.selected.nextElementSibling;(!c&&0<b||!d&&0>b)&&(b=0),this._translateX(this.selected,b),c&&this._translateX(c,b-this.offsetWidth),d&&this._translateX(d,b+this.offsetWidth),this._blurWrapper(b)}}}_touchend(a){if(!(2>this.childElementCount)&&!a.touches.length){if('x'===this._touchDir){let b=Math.round(a.changedTouches[0].clientX-this._startX);const c=this.selected.previousElementSibling,d=this.selected.nextElementSibling;(!c&&0<b||!d&&0>b)&&(b=0),0<b?100<b?(b===this.offsetWidth?this._resetChildrenStyles():(this._translateX(c,0,!0),this._translateX(this.selected,this.offsetWidth,!0)),this.selected=c):(this._translateX(c,-this.offsetWidth,!0),this._translateX(this.selected,0,!0)):0>b?-100>b?(b===-this.offsetWidth?this._resetChildrenStyles():(this._translateX(this.selected,-this.offsetWidth,!0),this._translateX(d,0,!0)),this.selected=d):(this._translateX(this.selected,0,!0),this._translateX(d,this.offsetWidth,!0)):this._resetChildrenStyles()}this._blurWrapper(0,!0),this._touchDir=null}}}customElements.define(FancyCarousel.is,FancyCarousel);</script></dom-module><script>(function(){'use strict';function a(a,b,c,d,e){let f;e&&(f='object'===typeof c&&null!==c,f&&(d=a.__dataTemp[b]));let g=d!==c&&(d===d||c===c);return f&&g&&(a.__dataTemp[b]=c),g}Polymer.MutableData=Polymer.dedupingMixin((b)=>{class c extends b{_shouldPropertyChange(b,c,d){return a(this,b,c,d,!0)}}return c.prototype.mutableData=!1,c}),Polymer.OptionalMutableData=Polymer.dedupingMixin((b)=>{class c extends b{static get properties(){return{mutableData:Boolean}}_shouldPropertyChange(b,c,d){return a(this,b,c,d,this.mutableData)}}return c}),Polymer.MutableData._mutablePropertyChange=a})();</script><script>(function(){'use strict';function a(){return j}function b(a,b){j=a,Object.setPrototypeOf(a,b.prototype),new b,j=null}function c(a){let b=a.__dataHost;return b&&b._methodHost||b}function d(a,b,c){let d=c.mutableData?o:n,e=class extends d{};return e.prototype.__templatizeOptions=c,e.prototype._bindTemplate(a),g(e,a,b,c),e}function e(a,c,d){let e=d.forwardHostProp;if(e){let g=c.templatizeTemplateClass;if(!g){let a=d.mutableData?l:k;g=c.templatizeTemplateClass=class extends a{};let b=c.hostProps;for(let a in b)g.prototype._addPropertyEffect('_host_'+a,g.prototype.PROPERTY_EFFECT_TYPES.PROPAGATE,{fn:f(a,e)}),g.prototype._createNotifyingProperty('_host_'+a)}b(a,g),a.__dataProto&&Object.assign(a.__data,a.__dataProto),a.__dataTemp={},a.__dataPending=null,a.__dataOld=null,a._enableProperties()}}function f(a,b){return function(a,c,d){b.call(a.__templatizeOwner,c.substring(6),d[c])}}function g(a,b,c,d){let e=c.hostProps||{};for(let f in d.instanceProps){delete e[f];let b=d.notifyInstanceProp;b&&a.prototype._addPropertyEffect(f,a.prototype.PROPERTY_EFFECT_TYPES.NOTIFY,{fn:h(f,b)})}if(d.forwardHostProp&&b.__dataHost)for(let b in e)a.prototype._addPropertyEffect(b,a.prototype.PROPERTY_EFFECT_TYPES.NOTIFY,{fn:i()})}function h(a,b){return function(a,c,d){b.call(a.__templatizeOwner,a,c,d[c])}}function i(){return function(a,b,c){a.__dataHost._setPendingPropertyOrPath('_host_'+b,c[b],!0,!0)}}let j=null;a.prototype=Object.create(HTMLTemplateElement.prototype,{constructor:{value:a,writable:!0}});const k=Polymer.PropertyEffects(a),l=Polymer.MutableData(k),m=Polymer.PropertyEffects(class{});class n extends m{constructor(a){super(),this._configureProperties(a),this.root=this._stampTemplate(this.__dataHost);let b=this.children=[];for(let c=this.root.firstChild;c;c=c.nextSibling)b.push(c),c.__templatizeInstance=this;this.__templatizeOwner.__hideTemplateChildren__&&this._showHideChildren(!0);let c=this.__templatizeOptions;(a&&c.instanceProps||!c.instanceProps)&&this._enableProperties()}_configureProperties(a){let b=this.__templatizeOptions;if(a)for(let c in b.instanceProps)c in a&&this._setPendingProperty(c,a[c]);for(let b in this.__hostProps)this._setPendingProperty(b,this.__dataHost['_host_'+b])}forwardHostProp(a,b){this._setPendingPropertyOrPath(a,b,!1,!0)&&this.__dataHost._enqueueClient(this)}_addEventListenerToNode(a,b,c){if(this._methodHost&&this.__templatizeOptions.parentModel)this._methodHost._addEventListenerToNode(a,b,(a)=>{a.model=this,c(a)});else{let d=this.__dataHost.__dataHost;d&&d._addEventListenerToNode(a,b,c)}}_showHideChildren(a){let b=this.children;for(let c,d=0;d<b.length;d++)c=b[d],!!a!=!!c.__hideTemplateChildren__&&(c.nodeType===Node.TEXT_NODE?a?(c.__polymerTextContent__=c.textContent,c.textContent=''):c.textContent=c.__polymerTextContent__:c.style&&(a?(c.__polymerDisplay__=c.style.display,c.style.display='none'):c.style.display=c.__polymerDisplay__)),c.__hideTemplateChildren__=a,c._showHideChildren&&c._showHideChildren(a)}_setUnmanagedPropertyToNode(a,b,c){a.__hideTemplateChildren__&&a.nodeType==Node.TEXT_NODE&&'textContent'==b?a.__polymerTextContent__=c:super._setUnmanagedPropertyToNode(a,b,c)}get parentModel(){let a=this.__parentModel;if(!a){let b;a=this;do a=a.__dataHost.__dataHost;while((b=a.__templatizeOptions)&&!b.parentModel);this.__parentModel=a}return a}}n.prototype.__dataHost,n.prototype.__templatizeOptions,n.prototype._methodHost,n.prototype.__templatizeOwner,n.prototype.__hostProps;const o=Polymer.MutableData(n),p={templatize(a,b,f){if(f=f||{},a.__templatizeOwner)throw new Error('A <template> can only be templatized once');a.__templatizeOwner=b;let g=b.constructor._parseTemplate(a),h=g.templatizeInstanceClass;h||(h=d(a,g,f),g.templatizeInstanceClass=h),e(a,g,f);let i=class extends h{};return i.prototype._methodHost=c(a),i.prototype.__dataHost=a,i.prototype.__templatizeOwner=b,i.prototype.__hostProps=g.hostProps,i=i,i},modelForElement(a,b){for(let c;b;)if(!(c=b.__templatizeInstance))b=b.parentNode;else if(c.__dataHost!=a)b=c.__dataHost;else return c;return null}};Polymer.Templatize=p,Polymer.TemplateInstanceBase=n})();</script><script>(function(){'use strict';class a{constructor(){this._asyncModule=null,this._callback=null,this._timer=null}setConfig(a,b){this._asyncModule=a,this._callback=b,this._timer=this._asyncModule.run(()=>{this._timer=null,this._callback()})}cancel(){this.isActive()&&(this._asyncModule.cancel(this._timer),this._timer=null)}flush(){this.isActive()&&(this.cancel(),this._callback())}isActive(){return null!=this._timer}static debounce(b,c,d){return b instanceof a?b.cancel():b=new a,b.setConfig(c,d),b}}Polymer.Debouncer=a})();</script><script>(function(){'use strict';function a(){const a=!!b.length;for(;b.length;)try{b.shift().flush()}catch(a){setTimeout(()=>{throw a})}return a}let b=[];Polymer.enqueueDebouncer=function(a){b.push(a)},Polymer.flush=function(){let b,c;do b=window.ShadyDOM&&ShadyDOM.flush(),window.ShadyCSS&&window.ShadyCSS.ScopingShim&&window.ShadyCSS.ScopingShim.flush(),c=a();while(b||c)}})();</script><script>(function(){'use strict';Polymer.TemplateInstanceBase;const a=Polymer.OptionalMutableData(Polymer.Element);class b extends a{static get is(){return'dom-repeat'}static get template(){return null}static get properties(){return{items:{type:Array},as:{type:String,value:'item'},indexAs:{type:String,value:'index'},itemsIndexAs:{type:String,value:'itemsIndex'},sort:{type:Function,observer:'__sortChanged'},filter:{type:Function,observer:'__filterChanged'},observe:{type:String,observer:'__observeChanged'},delay:Number,renderedItemCount:{type:Number,notify:!0,readOnly:!0},initialCount:{type:Number,observer:'__initializeChunking'},targetFramerate:{type:Number,value:20},_targetFrameTime:{type:Number,computed:'__computeFrameTime(targetFramerate)'}}}static get observers(){return['__itemsChanged(items.*)']}constructor(){super(),this.__instances=[],this.__limit=Infinity,this.__pool=[],this.__renderDebouncer=null,this.__itemsIdxToInstIdx={},this.__chunkCount=null,this.__lastChunkTime=null,this.__sortFn=null,this.__filterFn=null,this.__observePaths=null,this.__ctor=null,this.__isDetached=!0,this.template=null}disconnectedCallback(){super.disconnectedCallback(),this.__isDetached=!0;for(let a=0;a<this.__instances.length;a++)this.__detachInstance(a)}connectedCallback(){if(super.connectedCallback(),this.style.display='none',this.__isDetached){this.__isDetached=!1;let a=this.parentNode;for(let b=0;b<this.__instances.length;b++)this.__attachInstance(b,a)}}__ensureTemplatized(){if(!this.__ctor){let a=this.template=this.querySelector('template');if(!a){let a=new MutationObserver(()=>{if(this.querySelector('template'))a.disconnect(),this.__render();else throw new Error('dom-repeat requires a <template> child')});return a.observe(this,{childList:!0}),!1}let b={};b[this.as]=!0,b[this.indexAs]=!0,b[this.itemsIndexAs]=!0,this.__ctor=Polymer.Templatize.templatize(a,this,{mutableData:this.mutableData,parentModel:!0,instanceProps:b,forwardHostProp:function(a,b){let c=this.__instances;for(let d,e=0;e<c.length&&(d=c[e]);e++)d.forwardHostProp(a,b)},notifyInstanceProp:function(a,b,c){if(Polymer.Path.matches(this.as,b)){let d=a[this.itemsIndexAs];b==this.as&&(this.items[d]=c);let e=Polymer.Path.translate(this.as,'items.'+d,b);this.notifyPath(e,c)}}})}return!0}__getMethodHost(){return this.__dataHost._methodHost||this.__dataHost}__sortChanged(a){let b=this.__getMethodHost();this.__sortFn=a&&('function'==typeof a?a:function(){return b[a].apply(b,arguments)}),this.items&&this.__debounceRender(this.__render)}__filterChanged(a){let b=this.__getMethodHost();this.__filterFn=a&&('function'==typeof a?a:function(){return b[a].apply(b,arguments)}),this.items&&this.__debounceRender(this.__render)}__computeFrameTime(a){return Math.ceil(1e3/a)}__initializeChunking(){this.initialCount&&(this.__limit=this.initialCount,this.__chunkCount=this.initialCount,this.__lastChunkTime=performance.now())}__tryRenderChunk(){this.items&&this.__limit<this.items.length&&this.__debounceRender(this.__requestRenderChunk)}__requestRenderChunk(){requestAnimationFrame(()=>this.__renderChunk())}__renderChunk(){let a=performance.now(),b=this._targetFrameTime/(a-this.__lastChunkTime);this.__chunkCount=Math.round(this.__chunkCount*b)||1,this.__limit+=this.__chunkCount,this.__lastChunkTime=a,this.__debounceRender(this.__render)}__observeChanged(){this.__observePaths=this.observe&&this.observe.replace('.*','.').split(' ')}__itemsChanged(a){this.items&&!Array.isArray(this.items)&&console.warn('dom-repeat expected array for `items`, found',this.items),this.__handleItemPath(a.path,a.value)||(this.__initializeChunking(),this.__debounceRender(this.__render))}__handleObservedPaths(a){if(this.__observePaths){a=a.substring(a.indexOf('.')+1);let b=this.__observePaths;for(let c=0;c<b.length;c++)if(0===a.indexOf(b[c]))return this.__debounceRender(this.__render,this.delay),!0}}__debounceRender(a,b=0){this.__renderDebouncer=Polymer.Debouncer.debounce(this.__renderDebouncer,0<b?Polymer.Async.timeOut.after(b):Polymer.Async.microTask,a.bind(this)),Polymer.enqueueDebouncer(this.__renderDebouncer)}render(){this.__debounceRender(this.__render),Polymer.flush()}__render(){this.__ensureTemplatized()&&(this.__applyFullRefresh(),this.__pool.length=0,this._setRenderedItemCount(this.__instances.length),this.dispatchEvent(new CustomEvent('dom-change',{bubbles:!0,composed:!0})),this.__tryRenderChunk())}__applyFullRefresh(){let c=this.items||[],a=Array(c.length);for(let b=0;b<c.length;b++)a[b]=b;this.__filterFn&&(a=a.filter((a,b,d)=>this.__filterFn(c[a],b,d))),this.__sortFn&&a.sort((d,a)=>this.__sortFn(c[d],c[a]));const b=this.__itemsIdxToInstIdx={};let d=0;for(const e=Math.min(a.length,this.__limit);d<e;d++){let e=this.__instances[d],f=a[d],g=c[f];b[f]=d,e&&d<this.__limit?(e._setPendingProperty(this.as,g),e._setPendingProperty(this.indexAs,d),e._setPendingProperty(this.itemsIndexAs,f),e._flushProperties()):this.__insertInstance(g,d,f)}for(let a=this.__instances.length-1;a>=d;a--)this.__detachAndRemoveInstance(a)}__detachInstance(a){let b=this.__instances[a];for(let c,d=0;d<b.children.length;d++)c=b.children[d],b.root.appendChild(c);return b}__attachInstance(a,b){let c=this.__instances[a];b.insertBefore(c.root,this)}__detachAndRemoveInstance(a){let b=this.__detachInstance(a);b&&this.__pool.push(b),this.__instances.splice(a,1)}__stampInstance(a,b,c){let d={};return d[this.as]=a,d[this.indexAs]=b,d[this.itemsIndexAs]=c,new this.__ctor(d)}__insertInstance(a,b,c){let d=this.__pool.pop();d?(d._setPendingProperty(this.as,a),d._setPendingProperty(this.indexAs,b),d._setPendingProperty(this.itemsIndexAs,c),d._flushProperties()):d=this.__stampInstance(a,b,c);let e=this.__instances[b+1],f=e?e.children[0]:this;return this.parentNode.insertBefore(d.root,f),this.__instances[b]=d,d}_showHideChildren(a){for(let b=0;b<this.__instances.length;b++)this.__instances[b]._showHideChildren(a)}__handleItemPath(a,b){let c=a.slice(6),d=c.indexOf('.'),e=0>d?c:c.substring(0,d);if(e==parseInt(e,10)){let a=0>d?'':c.substring(d+1);this.__handleObservedPaths(a);let f=this.__itemsIdxToInstIdx[e],g=this.__instances[f];if(g){let c=this.as+(a?'.'+a:'');g._setPendingPropertyOrPath(c,b,!1,!0),g._flushProperties()}return!0}}itemForElement(a){let b=this.modelForElement(a);return b&&b[this.as]}indexForElement(a){let b=this.modelForElement(a);return b&&b[this.indexAs]}modelForElement(a){return Polymer.Templatize.modelForElement(this.template,a)}}customElements.define(b.is,b),Polymer.DomRepeat=b})();</script><dom-module id="fancy-sticker"><template><style>:host([show-bounds]) img{outline:1px solid red;}img{position:absolute;transform-origin:center center;will-change:transform, opacity;width:128px;height:128px;}img.moving{opacity:0.7;}img.removing{opacity:0.3;}</style><img id="img" src="[[src]]" alt$="[[alt]]" on-load="_stickerLoad" on-touchstart="_touchstart" on-touchmove="_touchmove" on-touchend="_touchend"></template><script>customElements.define('fancy-sticker',class extends Polymer.Element{static get is(){return'fancy-sticker'}static get properties(){return{alt:{type:String},src:{type:String},bounds:{type:Object},anchor:{type:Object},rotation:{type:Object},showBounds:{type:Boolean,reflectToAttribute:!0}}}static get observers(){return['_computePosition(bounds, anchor, rotation)']}_touchstart(a){a.preventDefault(),this._scrollTop=this.getBoundingClientRect().top,this._setBaseCoordinates(a.touches),this._timer&&window.clearTimeout(this._timer),this._timer=null,1===a.touches.length&&(this._baseTouch=a.touches[0],this._timer=window.setTimeout(()=>{this.$.img.classList.add('moving'),this._timer=null},300))}_touchmove(a){if(!this.$.img.classList.contains('moving')){if(this._timer){const b=this._distanceBetween(a.touches[0],this._baseTouch);10<b&&(window.clearTimeout(this._timer),this._timer=null)}return}a.preventDefault(),a.stopPropagation();const b=a.touches[0];if(1<a.touches.length){const c=a.touches[1],d=this._distanceBetween(b,c);if(0<this._baseDistance){const a=d/this._baseDistance;this._baseX*=a,this._baseY*=a,this._scale*=a}this._baseDistance=d}this._x=b.pageX-this._baseX,this._y=b.pageY-this._scrollTop-this._baseY,this.$.img.classList.toggle('removing',50>b.pageY),this._positionIcon()}_touchend(a){a.preventDefault(),this._timer&&window.clearTimeout(this._timer),this._timer=null,a.touches.length?a.stopPropagation():this.$.img.classList.contains('removing')?this.parentNode.removeChild(this):this.$.img.classList.remove('moving')}drawIntoContext(a){const b=this._scale*this.$.img.width,c=this._scale*this.$.img.height,d=this._x+this.$.img.width*this._ax,e=this._y+this.$.img.height*this._ay,f=this._rz*Math.PI/180;a.translate(d,e),a.rotate(f),a.scale(this._flip,1),a.drawImage(this.$.img,-b*this._ax,-c*this._ay,b,c),a.scale(this._flip,1),a.rotate(-f),a.translate(-d,-e)}_distanceBetween(c,d){const e=c.pageX-d.pageX,a=c.pageY-d.pageY;return Math.sqrt(e*e+a*a)}_computePosition(a,b,c){var d=Number.isFinite;b=b||{},this._ax=d(b.x)?b.x:0.5,this._ay=d(b.y)?b.y:0.5,a=a||{left:40,top:40,width:128,height:128},this._x=a.left+(a.width-128)*this._ax,this._y=a.top+(a.height-128)*this._ay,this._scale=a.width/128,c=c||{},this._rx=c.x||0,this._ry=c.y||0,this._rz=c.z||0,this._flip=0<this._ry?-1:1,this.$.img.style.transformOrigin=`${100*this._ax}% ${100*this._ay}%`,this._positionIcon()}_positionIcon(){this.$.img.style.transform=`translate3d(${this._x}px,${this._y}px,0) rotate(${this._rz}deg) scaleX(${this._flip}) scale(${this._scale})`}_setBaseCoordinates(a){const b=a[0];if(this._baseX=b.pageX-this._x,this._baseY=b.pageY-this._scrollTop-this._y,1<a.length){const c=a[1];this._baseDistance=this._distanceBetween(b,c)}else this._baseDistance=0}_stickerLoad(){this.dispatchEvent(new CustomEvent('sticker-load',{bubbles:!0,composed:!0}))}});</script></dom-module><dom-module id="fancy-sticker-layer"><template><style>:host{overflow:hidden;}</style><dom-repeat items="[[stickers]]" as="sticker"><template><fancy-sticker src="[[sticker.url]]" alt="[[sticker.alt]]" bounds="[[sticker.bounds]]" anchor="[[sticker.bounds.anchorPoint]]" rotation="[[sticker.bounds.rotation]]" show-bounds="[[showBounds]]"></fancy-sticker></template></dom-repeat></template><script>customElements.define('fancy-sticker-layer',class extends Polymer.Element{static get is(){return'fancy-sticker-layer'}static get properties(){return{faces:{type:Array},random:{type:Boolean},types:{type:Array},stickers:{type:Array,readOnly:!0},showBounds:{type:Boolean}}}static get observers(){return['_updateStickers(types, random, faces)']}drawIntoContext(a){this.shadowRoot.querySelectorAll('fancy-sticker').forEach((b)=>b.drawIntoContext(a))}randomize(){this.random&&this._updateStickers()}_updateStickers(){const a=this._computeStickers(this.types,this.random,this.faces);this._setStickers(a)}_computeStickers(a,b,c){if(!c||!a||!a.length)return null;const d=a.length,e=!Array.isArray(a[0]);return c.reduce((c,f,g)=>{var h=Math.floor;let i=a;if(!e){if(b&&1<d){for(g=h(Math.random()*d);f.__stickerTypes===a&&f.__stickerIndex===g;)g=h(Math.random()*d);f.__stickerTypes=a,f.__stickerIndex=g}else g%=d;i=a[g]}return i.forEach((a)=>{const b=this._getSticker(a,f);b&&c.push(b)}),c},[])}_getSticker(a,b){const c=a.name;if('emotion'===c){const c=b.emotions[0],d=a.urls?a.urls[c]:a.url;return{url:d||`stickers/${c}.svg`,alt:a.alt||c,bounds:b.bounds.face}}return b.bounds[c]?{url:a.url||`stickers/${c}.svg`,alt:a.alt||c,bounds:b.bounds[c]}:void 0}});</script></dom-module><dom-module id="fancy-image"><template><style>:host{display:inline-block;position:relative;overflow:hidden;font-size:0;}fancy-carousel,
      fancy-sticker-layer{position:absolute;top:0;bottom:0;left:0;right:0;user-select:none;}img:not([visible]),
      button:not([visible]){display:none;}fancy-carousel:not([visible]){visibility:hidden;}#randomizer{position:fixed;font-size:0;right:5px;bottom:90px;width:50px;height:50px;padding:14px;box-sizing:content-box;background-color:transparent;border:none;}.randomizing{will-change:filter, transform;filter:opacity(1);transition:filter 250ms ease-in, transform 250ms ease-in;}.randomizing.hide{transform:scale(1.1);filter:opacity(0);}button{outline:none;border-radius:50%;filter:drop-shadow(0px 1px 1px rgba(0, 0, 0, 0.8));}button:focus{filter:drop-shadow(0px 0px 5px white);}button:active{filter:drop-shadow(0px 0px 5px white) contrast(300%);}</style><img id="baseImage" src$="[[baseImageDataUrl]]" alt$="[[_computeImgAlt(annotations.labelAnnotations)]]" visible$="[[_isDefined(baseImageDataUrl)]]"><fancy-carousel id="carousel" selected="{{selected}}" visible$="[[_isDefined(annotations.faceAnnotations)]]"><fancy-sticker-layer faces="[[annotations.faceAnnotations]]" types="[[_mergeTypes(emotionType, otherEyesType, noseType, fancyType, cheesyType, royalType, graduationType)]]" random="" show-bounds="[[showBounds]]"></fancy-sticker-layer><fancy-sticker-layer faces="[[annotations.faceAnnotations]]" types="[[_concatTypes(emotionType, hatType)]]" show-bounds="[[showBounds]]"></fancy-sticker-layer><fancy-sticker-layer faces="[[annotations.faceAnnotations]]" types="[[_concatTypes(cheesyType, noseType)]]" show-bounds="[[showBounds]]"></fancy-sticker-layer><fancy-sticker-layer faces="[[annotations.faceAnnotations]]" types="[[otherEyesType]]" show-bounds="[[showBounds]]"></fancy-sticker-layer><fancy-sticker-layer faces="[[annotations.faceAnnotations]]" types="[[fancyType]]" show-bounds="[[showBounds]]"></fancy-sticker-layer><fancy-sticker-layer faces="[[annotations.faceAnnotations]]" types="[[_concatTypes(otherEyesType, noseType, mouthType)]]" show-bounds="[[showBounds]]"></fancy-sticker-layer><fancy-sticker-layer faces="[[annotations.faceAnnotations]]" types="[[emotionType]]" show-bounds="[[showBounds]]"></fancy-sticker-layer></fancy-carousel><button id="randomizer" aria-label="randomize" visible$="[[_canRandomize(selected, annotations.faceAnnotations)]]" on-click="_randomize"><svg fill="#ffffff" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"></path></svg></button></template><script>customElements.define('fancy-image',class extends Polymer.Element{static get is(){return'fancy-image'}static get properties(){return{baseImageDataUrl:{type:String},annotations:{type:Object},selected:{type:Object},showBounds:{type:Boolean},showPreview:{type:Boolean,observer:'_showPreviewChanged'},emotionType:{type:Array,readOnly:!0,value:()=>[{name:'emotion'}]},eyesType:{type:Array,readOnly:!0,value:()=>[{name:'eyes'}]},otherEyesType:{type:Array,readOnly:!0,value:()=>[{name:'leftEye'},{name:'rightEye'}]},noseType:{type:Array,readOnly:!0,value:()=>[{name:'nose',url:'stickers/pig-nose.svg'}]},hatType:{type:Array,readOnly:!0,value:()=>[{name:'forehead',url:'stickers/hat.svg'}]},mouthType:{type:Array,readOnly:!0,value:()=>[{name:'mouth',url:'stickers/lips.svg'}]},fancyType:{type:Object,readOnly:!0,value:()=>[{name:'forehead',url:'stickers/hat.svg'},{name:'eyes',url:'stickers/sun-glasses.svg'}]},cheesyType:{type:Object,readOnly:!0,value:()=>[{name:'forehead',url:'stickers/cheese.svg'},{name:'eyes',url:'stickers/sun-glasses.svg'}]},royalType:{type:Object,readOnly:!0,value:()=>[{name:'forehead',url:'stickers/crown.svg'},{name:'eyes',url:'stickers/eyes.svg'}]},graduationType:{type:Object,readOnly:!0,value:()=>[{name:'forehead',url:'stickers/graduation-hat.svg'}]},cloudyType:{type:Object,readOnly:!0,value:()=>[{name:'aboveFace',url:'stickers/rainy-cloud.svg'}]},_testType:{type:Object,readOnly:!0,value:()=>[{name:'rightEar',url:'stickers/steam.svg'}]}}}get previewImageDataUrl(){const a=document.createElement('canvas');a.width=this.$.baseImage.width,a.height=this.$.baseImage.height;const b=a.getContext('2d');return b.drawImage(this.$.baseImage,0,0),this.$.carousel.selected.drawIntoContext(b),a.toDataURL('image/jpeg')}_computeImgAlt(a){if(!a)return'';const b=[];return a.every((a)=>!!(.55<=a.score)&&(b.push(a.description),!0)),b.join(',')}_isDefined(a){return!!a}_showPreviewChanged(a){a?(this.$.baseImage.src=this.previewImageDataUrl,this.$.carousel.style.display='none'):(this.$.baseImage.src=this.baseImageDataUrl,this.$.carousel.style.display='')}_canRandomize(a,b){return!!a&&!!a.random&&!!b}_randomize(){const a=this.selected,b=this.$.randomizer;a.classList.contains('randomizing')||(a.addEventListener('transitionend',function c(){a.removeEventListener('transitionend',c),a.randomize(),setTimeout(()=>{a.addEventListener('transitionend',function c(){a.removeEventListener('transitionend',c),a.classList.remove('randomizing'),b.style.transition='',b.style.transform=''}),a.classList.remove('hide')},100)}),a.classList.add('randomizing'),a.classList.add('hide'),b.style.transition='transform 400ms ease-in-out',b.style.transform='rotate(360deg)')}_concatTypes(){const a=Array.from(arguments);return a.reduce((a,b)=>b?a.concat(b):a,[])}_mergeTypes(){const a=Array.from(arguments);return a.reduce((a,b)=>(b&&a.push(b),a),[])}});</script></dom-module><script>(function(){function a(a,b){var c=Math.PI,d=document.createElement('canvas'),e=a.width,f=a.height,g=b.orientation,h=window.innerWidth/(g&&4<g?f:e);1>h&&(e*=h,f*=h),d.width=e,d.height=f;var i=d.getContext('2d');return g&&9>g&&(4<g&&(d.width=f,d.height=e),2===g?(i.translate(e,0),i.scale(-1,1)):3===g?(i.translate(e,f),i.rotate(Math.PI)):4===g?(i.translate(0,f),i.scale(1,-1)):5===g?(i.rotate(0.5*c),i.scale(1,-1)):6===g?(i.rotate(0.5*c),i.translate(0,-f)):7===g?(i.rotate(0.5*c),i.translate(e,-f),i.scale(-1,1)):8===g?(i.rotate(-0.5*c),i.translate(-e,0)):void 0),i.drawImage(a,0,0,e,f),d}function b(a,b){var c={},d=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);if(!window.DataView||!a||12>a.size||'image/jpeg'!==a.type||!d)return void b(c);var e=new FileReader;e.onerror=function(){b(c)},e.onload=function(a){var d,e,g=new DataView(a.target.result),h=2,i=g.byteLength-4;if(65496===g.getUint16(0))for(;h<i&&(d=g.getUint16(h),65504<=d&&65519>=d||65534===d)&&(e=g.getUint16(h+2)+2,!(h+e>g.byteLength));)65505===d&&f(g,h,e,c),h+=e;else;b(c)},e.readAsArrayBuffer(d.call(a,0,262144))}function c(a,b,c,d,e,f){if(3===d){var g=2*e,h=4<g?b+a.getUint32(c+8,f):c+8;return h+g>a.byteLength?void 0:1===e?a.getUint16(h,f):void 0}}function d(a,b,d,e,f){var g=a.getUint16(d,e);274===g&&(f.orientation=c(a,b,d,a.getUint16(d+2,e),a.getUint32(d+4,e),e))}function e(a,b,c,e,f){var g,h,j;if(!(c+6>a.byteLength)&&(g=a.getUint16(c,e),h=c+2+12*g,!(h+4>a.byteLength))){for(j=0;j<g;j+=1)d(a,b,c+2+12*j,e,f);return a.getUint32(h,e)}}function f(a,b,c,d){var f,g,h=b+10;if(1165519206===a.getUint32(b+4)&&!(h+8>a.byteLength)&&0===a.getUint16(b+8)){switch(a.getUint16(h)){case 18761:f=!0;break;case 19789:f=!1;break;default:return;}42!==a.getUint16(h+2,f)||(g=a.getUint32(h+4,f),g=e(a,h,h+g,f,d))}}window.loadImage=function(c,d){var e=new Image;e.onload=function(){URL.revokeObjectURL(e.src),b(c,function(b){d(a(e,b))})},e.src=URL.createObjectURL(c)}})();</script></div></body></html>